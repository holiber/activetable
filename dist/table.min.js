/*!
* ActiveTable 
* v0.4.2
* Licensed under the MIT license.
* @see: http://github.com/holiber/activetable
*/
!function(a){var b={data:null,name:"unnamed",templates:null,selectable:!1,perPage:20,fields:null,order:[],hiddenFields:["idx"],showOnlyDescribed:!1,sort:!1,widgets:{},widgetsOrder:[],helper:{},resizeThrottle:500,fieldsDefaults:{sortable:!0,editable:!1,compute:!1,type:!1,fixedWidth:!1,hint:!1,saveChange:!0,defaultValue:void 0,validation:void 0,maxValue:void 0,minValue:void 0,title:void 0,display:void 0},on:{}},c=Qstore.Class,d={length:function(a){var b=0;if($.isArray(a))return a.length;for(var c in a)b++;return b},toUnderscore:function(a){return a?a.replace(/([A-Z])/g,function(a,b){return"_"+b.toLowerCase()}):""},toScore:function(a){return a?(a=a.replace(/([A-Z])/g,function(a,b,c){return(0!=c?"-":"")+b.toLowerCase()}),a=a.replace(/(_)/g,"-")):""},toFormatedNumber:function(a){return 0===a?"0":a?String(a).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "):""},tocamelCase:function(a){return a?(a=a.replace(/([A-Z])/g,function(a,b,c){return 0!=c?b.toUpperCase():b.toLowerCase()}),a=a.replace(/(_)/g,""),a=a.replace(/(-)/g,"")):""},dateToSting:function(a){if(!a)return"";a instanceof Date||(a=new Date(a));var b=String(a.getDate());10>b&&(b="0"+b);var c=String(a.getMonth()+1);10>c&&(c="0"+c);var d=String(a.getFullYear());return b+"."+c+"."+d}},e=c.extend({init:function(a,b){this.table=a,this.container=null,this.name=b&&b.name||d.tocamelCase(this.componentName),this.el=null,this.enabled=!0},emit:function(a){if(this.on&&this.on[a]){var b=Array.prototype.slice.call(arguments,1);b.unshift(this),this.on[a].apply(this,b)}},disable:function(){this.enabled=!1,this.el&&this.el.off("."+this.name)},enable:function(){this.enabled=!0,this._attachEvents()},_attachEvents:function(){this.el&&this.el.off("."+this.name)},_receive:function(a){switch(a){case"disable":this.disable();break;case"enable":this.enable()}}},{installTemplate:function(a){this.prototype.tpl=a}}),f=a.ActiveTable=c.extend({defaultTemplates:null,utils:d,init:function(a){this.el=null,this.layout=null,this.jqWidgets=null,this.templates=null,this.name=null,this.data=null,this.visibleFields=[],this.showOnlyDescribed=!1,this.fields=null,this.perPage=null,this.fixedRowsCnt=!1,this.page=1,this.sort=null,this.defaultSort=!1,this.filters={defaultFilter:null},this.computedFilter=null,this.rowsCnt=null,this.widgets=null,this.widgetsOrder=null,this.selection=[],this._checkAll=!1,this.on=null,this.canSelectText=!0,this.cssClasses=[],this.locked=!1,this.enabled=!0,this.clientX=null,this.clientY=null,this.lastCheckedIdx=null,this.resizeThrottle=0,this.resizeTimeoutId=null,this._setOptions(a)},_setOptions:function(a){a=a||{},this.params=this.params||{},this.params=$.extend(!0,{},b,this.params,a),this.fields={},this.fieldsDefaults=this.params.fieldsDefaults,this.hiddenFields=this.params.hiddenFields,this.order=this.params.order,this.name=this.params.name,this.defaultSort=this.params.defaultSort,this.selectable=this.params.selectable,this.fixedRowsCnt=this.params.fixedRowsCnt,this.perPage=this.params.perPage,this.on=this.params.on,this.sort=this.params.sort,this.helper=this.params.helper,this.hasFooter=this.params.hasFooter,this.widgetsOrder=a.widgetsOrder||this.widgetsOrder||this.params.widgetsOrder,this.showOnlyDescribed=this.params.showOnlyDescribed,this.resizeThrottle=this.params.resizeThrottle,this.el=this.params.el,this.setData(this.params.data),this.setFields(this.params.fields),this.setTemplates(this.params.templates),this.rowsCnt=this.data.size(),(this.params.sort||this.sort)&&this.data.sort(this.params.sort||this.sort),this.emit("_setOptions"),this.widgets={};for(var c in this.params.widgets){var d=this.params.widgets[c],e=null;if("string"==typeof d&&(d=this.params.widgets[c]={widget:d}),d=$.extend({container:null,widget:null,name:null,params:null},d),f.widgetsSet[d.widget]){var g=f.widgetsSet[d.widget];e=new g(this,d.params),d.container&&(e.container=d.container),d.name&&(e.name=d.name)}else{if(!$.isFunction(d))throw"widget "+d.widget+" not found";e=new d(this)}this.widgets[d.widget]=e}for(var h in this.widgets)this.widgets[h]._receive("ready")},setOptions:function(a){a.data&&(this.setData(a.data),this._onDataChangeHandler()),a.el&&(this.layout=null,this.el=a.el),void 0!==a.selectable&&(this.selectable=a.selectable),a.helper&&(this.helper=a.helper),a.on&&(this.on=a.on),a.sort&&(this.sort=a.sort),a.hasFooter&&(this.hasFooter=a.hasFooter),a.templates&&this.setTemplates(a.templates),a.showOnlyDescribed&&(this.showOnlyDescribed=a.showOnlyDescribed),a.order&&(this.order=a.order),a.hiddenFields&&(this.hiddenFields=a.hiddenFields),a.perPage&&(this.perPage=a.perPage),(a.fields||a.order||a.showOnlyDescribed||a.hiddenFields||a.data||!a.data&&this.showOnlyDescribed)&&this.setFields(a.fields),(a.data||a.sort)&&this.data.sort(this.sort),this.emit("setOptions")},setData:function(a){this.data=a instanceof Qstore?a||{columns:[],rows:[]}:new Qstore(a),this.data.listener=$.proxy(this._dataListener,this)},setTemplates:function(a){$.isFunction(a)&&(a={columns:a,cells:a,feet:a,master:a}),this.templates=$.extend(!0,{},this.defaultTemplates,a)},setFields:function(a){a=a||this.fields;var b=[];for(var c in a){var d=a[c];$.isPlainObject(d)||(d={title:d}),d=$.extend(!0,{},this.fieldsDefaults,d),d.name=c,(d.compute||a[c])&&b.push(d),this.fields[c]=d}if(this.data)for(var e in this.data.columns){var c=this.data.columns[e];this.fields[c]||(this.fields[c]=$.extend({},this.params.fieldsDefaults))}this.visibleFields=this.order.length?[].concat(this.order):[].concat(this.data.columns);for(var f=this.visibleFields.length;f--;){var c=this.visibleFields[f];if(!this.fields[c])throw'field "'+c+'" not found';~$.inArray(c,this.hiddenFields)?this.visibleFields.splice(f,1):a[c]||!this.showOnlyDescribed||~$.inArray(c,this.order)||this.visibleFields.splice(f,1)}if(!this.showOnlyDescribed)for(var f=0;f<this.data.columns.length;f++){var g=this.data.columns[f];~$.inArray(g,this.visibleFields)||~$.inArray(g,this.hiddenFields)||this.visibleFields.push(g)}this.data.addFields(b)},render:function(a){var b=null;if("string"==typeof a){if(!this.layout)return!1;b=a,a=null}if(a&&a.length&&(this.el=a),b||this.el&&this.el.length){if(!this.templates.layout)throw"templates are not installed";var c=a&&a.length||!this.layout;if(b){var d=$(this.templates.renderer(this)).find(b);this.layout.find(b).replaceWith(d)}else this.layout=$(this.templates.renderer(this)),this.renderWidgets(),(c||!this.enabled)&&(this._attachEvents(),this.enabled=!0),this.el.html(this.layout);this.emit("render",b)}},disable:function(){this.enabled=!1,this.el&&this.el.off(".table"),this.emit("disable")},enable:function(){this.enabled=!1,this._attachEvents(),this.emit("enable")},forEach:function(a,b){var c=b?b:a,d=b?a:null;if(!this.data||!this.data.size())return 0;for(var e=0,f=0;f<this.data.rows.length;f++){var g=this.data.rows[f];Qstore.test(g,this.computedFilter)&&(!d||Qstore.test(g,d))&&(c(g),e++)}return e},find:function(a){for(var b=[],c=0;c<this.data.rows.length;c++){var d=this.data.rows[c];Qstore.test(d,this.computedFilter)&&Qstore.test(d,a)&&b.push(d)}return b},switchPage:function(a){if(!a||!this.perPage||!this.rowsCnt)return!1;var b=Math.ceil(this.rowsCnt/this.perPage);return"prev"==a&&(a=Number(this.page)-1),"next"==a&&(a=Number(this.page)+1),a>b||1>a?!1:(this.page=Number(a),this.saveState(),this.render(),this.emit("pageSwitch"),!0)},addFilter:function(a,b){var c=null,d=null;1==arguments.length&&(c=a),2==arguments.length&&(d=a,c=b),d=d||"defaultFilter",this.filters[d]=c,this._computeFilter()},removeFilter:function(a){a=a||"defaultFilter",delete this.filters[a],this._computeFilter()},renderWidgets:function(){var a=this.layout.find(".widgets");a.empty();var b={};for(var c in this.widgets){var d=this.widgets[c];d.container&&1==b[d.container]}for(var c in b){var e=b[c],f=this.layout.find(e);f.length&&f.empty()}for(var c in this.widgets){var d=this.widgets[c],e=d.container;e||(e=a),"string"==typeof e&&(e=this.layout.find(e));var g=$('<div class="widget widget-'+this.utils.toScore(d.name)+'"></div>');e.append(g),d.render&&d.render(g)}},resetSort:function(){this.sort=null},emit:function(a,b){for(var c=0;c<f.listeners.length;c++)f.listeners[c].call(this,a,b,this);for(var d in this.widgets)this.widgets[d]._receive(a,b);this.on&&this.on[a]&&this.on[a](b)},lock:function(){1!=this.locked&&(this.locked=!0,this.emit("tableLock"))},unlock:function(){0!=this.locked&&(this.locked=!1,this.emit("tableUnlock"))},addClass:function(a){return"string"!=typeof a?!1:~$.inArray(a,this.cssClasses)?!1:(this.cssClasses.push(a),this.layout&&this.layout.addClass(a),!0)},removeClass:function(a){if("string"!=typeof a)return!1;var b=$.inArray(a,this.cssClasses);return~b?(this.cssClasses.splice(b,1),this.layout&&this.layout.removeClass(a),!0):!1},getClasses:function(){var a=" "+this.utils.toScore(this.name+"-table active-table");return this.canSelectText||(a+=" unselectable"),this.selection.length&&(a+=" has-selected"),this.locked&&(a+=" locked"),this.cssClasses.length&&(a+=" "+this.cssClasses.join(" ")),a},saveState:function(){return!1},loadState:function(){var a=JSON.parse($.cookie("table_"+this.name));a=$.extend({page:this.page,perPage:this.perPage,sort:this.sort},a),this.page=a.page,this.perPage=a.perPage,this.sort=a.sort},enableTextSelection:function(){this.canSelectText=!0,this.layout.removeClass("unselectable")},disableTextSelection:function(){this.canSelectText=!1,this.layout.addClass("unselectable")},_computeFilter:function(){this.computedFilter={$and:[]};var a=0;for(var b in this.filters)this.filters[b]&&(this.computedFilter.$and.push(this.filters[b]),a++);a||(this.computedFilter=null),this.rowsCnt=this.computedFilter?this.data.find(this.computedFilter).length:this.data.size();var c=Math.ceil(this.rowsCnt/this.perPage);this.page<1&&(this.page=1),c&&this.page>c&&(this.page=c),this.emit("filter")},_attachEvents:function(){if(!this.el||!this.el.length)return!1;var a=this;return this.el.off(".table"),this.el.on("click.table",".dtable th",function(){var b=[],c=$(this).attr("rel"),d=!1;if(!a.fields[c]||!a.fields[c].sortable)return!1;var e="desc";return $(this).hasClass("desc")&&(e="asc"),$(this).hasClass("asc")&&(a.defaultSort?d=!0:e="desc"),d?(a.sort=null,a.data.sort(a.defaultSort)):(b.push({fieldName:c,order:e}),a.sort=b,a.data.sort(b)),a.saveState(),a.render(),!1}),this.emit("attachEvents",this),!0},_dataListener:function(a,b){switch(a){case"change":this._onDataChangeHandler(b);break;case"fieldsChange":this._onDataFieldsChangeHandler(b);break;case"commit":this._onDataCommitHandler(b)}},_onDataChangeHandler:function(a){this._computeFilter(),this.emit("dataChange",a),a&&(this.selection.length&&a.action&&~$.inArray(a.action,["remove","revert"])&&this.recheck(),a.action&&~$.inArray(a.action,["add","update"])&&(this.sort=null))},_onDataFieldsChangeHandler:function(a){if(a=$.extend({action:null,fields:[]},a),"remove"!=a.action)for(var b in this.data.columns){var c=this.data.columns[b];~$.inArray(c,this.hiddenFields)||this.fields[c]||(this.fields[c]=$.extend({},this.params.fieldsDefaults,{name:c}),this.showOnlyDescribed||this.visibleFields.push(c))}else for(var b in a.fields){var c=a.fields[b];if(this.fields[c]){var d=$.inArray(c,this.visibleFields);~d&&this.visibleFields.splice(d,1),delete this.fields[c]}}},_onDataCommitHandler:function(){this.emit("commit")}},{Widget:e,utils:d,widgetsSet:{},listeners:[],installWidget:function(a,b,c){switch(arguments.length){case 2:c=b,b=a;var d=f.Widget;break;case 3:var d=f.getWidget(a);if(!d)return console.log("parent widget not found"),!1;break;default:return console.error("wrong arguments count"),!1}var g=d.extend(c);g.installTemplate=e.installTemplate,g.prototype.componentName=b,f.widgetsSet[b]=g},installDefaultTemplates:function(a){this.prototype.defaultTemplates||(this.prototype.defaultTemplates={}),this.prototype.defaultTemplates=$.extend({},this.prototype.defaultTemplates,a)},getWidget:function(a){return this.widgetsSet[a]},addListener:function(a){this.listeners.push(a)}});f.installDefaultTemplates({renderer:function(a){var b,c,d,e,f,g="",h="",i="";if(a.selectable){g+=a.templates.checkboxHead({tplCheckboxHead:!0,table:a});var j=a.templates.checkboxFoot({tpl:{checkboxFoot:!0},table:a});h+=a.templates.checkboxFootWrap({tpl:{checkboxFootWrap:!0},table:a,content:j})}for(var k=0;k<a.visibleFields.length;k++){i=a.visibleFields[k];var l=a.fields&&a.fields[i]||!1;l=$.extend({},l),$.isFunction(l.title)&&(l.title=l.title(l,a));var m={tpl:{column:!0,field:{}},table:a,fieldName:i,title:l.title,field:l,sFieldName:a.utils.toScore(i),sort:a.sort&&a.sort[0]&&a.sort[0].fieldName==i?a.sort[0].order:"",type:l.type?a.utils.toScore(l.type):"",isFirst:!a.selectable&&i==a.visibleFields[0],isLast:i==a.visibleFields[a.visibleFields.length-1]};m.tpl.field[i]=!0;var n=$.extend({},m);n.tpl={foot:!0,field:{}},n.tpl.field[i]=!0;var o="",p="";$.isFunction(a.templates.columns)?o=a.templates.columns(m).trim():a.templates.columns[i]&&(o=a.templates.columns[i](m)),""===o&&(o=l.title||i),$.isFunction(a.templates.feet)?p=a.templates.feet(n).trim():a.templates.feet[i]&&(p=a.templates.feet[i](n));var q=m;q.tpl={columnWrap:!0,field:{}},q.tpl.field[i]=!0;var r=$.extend({},q);r.tpl={footWrap:!0,field:{}},q.tpl.field[i]=!0,q.content=o,r.content=p;var s=a.templates.columnWrap(m),t=a.templates.footWrap(r);g+=s,h+=t}e=a.templates.thead({tpl:{thead:!0},table:a,columns:g}),f=a.templates.tfoot({tpl:{tfoot:!0},table:a,columns:h});var u="",v=a.data.find(a.computedFilter||!0),w=a.page*a.perPage-a.perPage,x=w+a.perPage,y=!!(w%2);a.data&&x>a.rowsCnt&&(x=a.rowsCnt),a.data&&w>a.rowsCnt&&(w=0),a.rowsCnt||(u+=a.templates.emptyRow({tpl:{emptyRow:!0},table:a}));for(var z=w;x>z;z++){var A=v[z];if(A){var B={tpl:{row:!0},table:a,row:A,odd:y},C=a.templates.trow(B),D={tpl:{rowWrap:!0},table:a,row:A,odd:y,cells:C},A=a.templates.rowWrap(D);u+=A,y=!y}}var E=a.perPage-(x-w);if(a.fixedRowsCnt&&E){for(var F={},z=0;z<a.data.columns;z++)F[a.data.columns[z]]=null;for(var z=0;E>z;z++){var B={tpl:{row:!0},table:a,fake:!0,row:A,odd:y},C=a.templates.trow(B),D={tpl:{rowWrap:!0},table:a,fake:!0,row:A,odd:y,cells:C},A=a.templates.rowWrap(D);u+=A,y=!y}}return d=a.templates.tbody({tpl:{tbody:!0},table:a,rows:u}),c=a.templates.table({tpl:{table:!0},table:a,thead:e,tbody:d,tfoot:f}),b=a.templates.layout({tpl:{layout:!0},table:a,ttable:c})},layout:function(a){return'<div class="'+a.table.getClasses()+'"><div class="table-wrap"><div class="lock-overlay"></div><div class="widgets"></div><div class="dtable">'+a.ttable+'</div><div class="bottom-widgets"></div><div class="clearfix" style="clear:both"></div></div></div>'},table:function(a){return'<table class="data-table" cellspacing="0">'+a.thead+a.tfoot+a.tbody+"</table>"},tbody:function(a){return"<tbody>"+a.rows+"</tbody>"},thead:function(a){return"<thead><tr>"+a.columns+"</tr></thead>"},tfoot:function(a){return a.table.hasFooter?"<tfoot><tr>"+a.columns+"</tr></tfoot>":""},trow:function(a){var b=(a.table.templates,a.row),c=a.table,d="";c.selectable&&(d+=c.templates.checkboxCell({tpl:{checkboxCell:!0},row:b}));for(var e=0;e<c.visibleFields.length;e++){var f=a.table.visibleFields[e],g=a.table.fields[f],h=$.extend({value:b[f],display:b[f]},g),i={tpl:{cell:!0,field:{}},table:c,cell:h,row:b,fieldName:f,sFieldName:c.utils.toScore(f),fake:a.fake,isFirst:!c.selectable&&f==c.visibleFields[0],isLast:f==c.visibleFields[c.visibleFields.length-1],sort:c.sort&&c.sort[0]&&c.sort[0].fieldName==f?"."+c.sort[0].order:""};if(i.tpl.field[f]=!0,a.fake)h.display="";else{switch(h.display&&$.isFunction(h.display)&&(h.display=h.display({tpl:{cell:!0},cell:h,row:b,table:c})),h.type){case"date":h.display=c.utils.dateToSting(b[f])||g.defaultValue||"";break;case"number":null!==h.display&&(h.display%1&&(h.display=h.display.toFixed(2)),h.display=String(h.display).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "))}if($.isFunction(c.templates.cells)){var j=c.templates.cells(i).trim();""!==j&&(h.display=j)}else c.templates.cells[f]&&(h.display=c.templates.cells[f](i))}var k=i;k.tpl={cellWrap:!0,field:{}},k.tpl.field=f,d+=c.templates.cellWrap(k)}return d},emptyRow:function(a){return'<tr class="empty-row fake"><td colspan="'+a.table.visibleFields.length+'"></td></tr>'},columnWrap:function(a){var b="";return a.isFirst&&(b+=" col-first"),a.isLast&&(b+=" col-last"),a.type&&(b+=" "+a.type),a.sort&&(b+=" "+a.sort),'<th class="col-'+a.sFieldName+b+'" rel="'+a.fieldName+'" title="'+a.field.hint+'"><div class="column-wrap col-'+a.sFieldName+'-wrap">'+a.content+"</div></th>"},footWrap:function(a){var b="";return a.isFirst&&(b+=" col-first"),a.isLast&&(b+=" col-last"),a.type&&(b+=" "+a.type),a.sort&&(b+=" "+a.sort),'<th class="col-'+a.sFieldName+b+'" rel="'+a.fieldName+'"><div class="foot-wrap col-'+a.sFieldName+'-wrap">'+a.content+"</div></th>"},cellWrap:function(a){var b="";return a.sort&&(b+=" "+a.sort),a.isFirst&&(b+=" col-first"),a.isLast&&(b+=" col-last"),a.cell.type&&(b+=" "+a.cell),a.cell.editable&&(b+=" editable"),'<td class="col-'+a.sFieldName+b+'" rel="'+a.sFieldName+'" value="'+a.row[a.fieldName]+'">'+a.cell.display+"</td>"},rowWrap:function(a){return'<tr class="'+(a.odd?"odd":"even")+(a.fake?" fake":"")+'" rel="'+a.row.idx+'">'+a.cells+"</tr>"},columns:{},cells:{},feet:{}})}(window),!function(a){function b(){var a=this,b=function(a){a.removeClass("hovered"),a.find(".editable").each(function(){var a=$(this),b=a.attr("rel");a.data("editArea")?(a.find('input[name="'+b+'"]').replaceWith(a.data("editArea")),a.removeData("editArea")):(a.html(a.data("content")),a.removeData("content"))})};this.el.on("mouseleave.table",".dtable",function(){b(a.el.find("tr.hovered:not(.focused)"))}.bind(this)),this.el.on("mouseenter.table","tr:not(.focused)",function(c){var d=a.el.find("tr.hovered:not(.focused)");b(d);var e=$(c.currentTarget);e.hasClass("fake")||e.hasClass("vscroll-overflow-tr")||(e.addClass("hovered"),e.find(".editable").each(function(){var a=$(this),b=a.attr("rel"),c=a.attr("value"),d=a.find(".edit-area"),e='<input type="text" name="'+b+'" value="'+(void 0!==c?c:"")+'"/>';if(!a.data("editArea"))if(d.length)a.data("editArea",d.replaceWith(e));else{var f=a.html();a.html(e),a.data("content",f)}}))}),this.el.on("focusin.table","tr .editable input",function(b){var c=$(b.currentTarget),d=c.closest("tr");a.el.find("tr.focused").removeClass("focused").mouseleave(),d.addClass("focused")}),this.el.on("focusout.table",".editable input",function(a){var c=$(a.currentTarget).closest("tr");c.removeClass("focused"),b(c)}),this.el.on("keyup.table",".editable input",function(b){var c=$(b.currentTarget),d=c.closest("td"),e=c.val(),f=a.fields[c.attr("name")],g=0;void 0!==f.minValue&&(""==e?g++:(e=Number(e),isNaN(e)?g++:e<f.minValue&&g++)),void 0!==f.maxValue&&(""==e?g++:(e=Number(e),isNaN(e)?g++:e>f.maxValue&&g++)),f.validation instanceof RegExp&&!f.validation.test(e)&&g++,g?d.addClass("invalid"):d.removeClass("invalid")}),this.el.on("keypress.table",".editable input",function(a){var b=$(a.currentTarget).closest("td"),c=a.keyCode||a.which;b.hasClass("number")&&(~$.inArray(c,ARROWS_BS_DEL)||c>=DIGIT_BOUNDS[0]&&c<=DIGIT_BOUNDS[1]||a.preventDefault())}),this.el.on("change.table",".editable input",function(b){var c=$(b.currentTarget),d=c.closest("td");if(d.hasClass("invalid"))return a.render(),void 0;var e=d.closest("tr"),f=d.attr("rel"),g=e.attr("rel"),h={},i=a.fields[f],j=!i.saveChange;h[f]=c.val(),a.data.update({idx:g},h,j),a.render(),$.browser.msie||setTimeout(function(){var b=$(document.elementFromPoint(a.clientX,a.clientY)),c=b.closest("td"),d=c.closest("td");d.mouseenter(),c.is(".editable")&&c.find("input").focus()})})}a.addListener(function(a){"attachEvents"==a&&b.call(this)})}(ActiveTable),!function(a){function b(){this.el.on("click.table","td.col-checkbox",function(a){var b=$(a.currentTarget).find(".checkbox"),c=b.attr("rel");if(c){if(this.check(c,!b.hasClass("checked")),!a.shiftKey)return this.lastCheckedIdx=c,void 0;if(this.lastCheckedIdx){var d,e=c,f=this.lastCheckedIdx,g=this.el.find('.dtable tr[rel="'+e+'"]'),h=this.el.find('.dtable tr[rel="'+f+'"]');g.index()>h.index()&&(d=g,g=h,h=d);for(var i=g,j=[];(i=i.next()).length&&i.attr("rel")!=h.attr("rel");)j.push(i.attr("rel"));this.check(j,!0),this.render()}}}.bind(this)),this.el.on("click.table","th.col-checkbox",function(a){var b=$(a.currentTarget).find(".checkbox");return b.hasClass("checked")?(this.checkAll(),void 0):b.hasClass("checked-all")?(this.checkAll(!1),void 0):(this.checkPage(),void 0)}.bind(this))}a.addListener(function(a){switch(a){case"attachEvents":b.call(this);break;case"checked":this._renderChecked()}}),$.extend(a.prototype,{check:function(a,b){($.isArray(a)||"number"==typeof a||"string"==typeof a)&&(a={idx:a}),void 0===b&&(b=!0),this.forEach(a,function(a){var c=a.idx,d=$.inArray(c,this.selection);if(b){if(~d)return;return this.selection.push(c),void 0}~d&&this.selection.splice(d,1)}.bind(this)),this.emit("selectionChange"),this._renderChecked()},checkedCnt:function(){return this._checkAll?this.rowsCnt:this.selection.length},recheck:function(){if(this.selectable){if(this._checkAll)return this.checkAll(),void 0;for(var a=0;a<this.data.rows.length;a++){var b=this.data.rows[a];if(!Qstore.test(b,this.computedFilter)){var c=$.inArray(b.idx,this.selection);~c&&this.selection.splice(c,1)}}this.emit("selectionChange"),this._renderChecked()}},checkPage:function(a){if(void 0===a&&(a=!0),a){var b=this.layout.find("th.col-checkbox .checkbox");b.removeClass("checked-all"),b.addClass("checked")}else this._checkAll=!1;var c=[],d=this.data.find(this.computedFilter||!0),e=this.page*this.perPage-this.perPage,f=e+this.perPage;this.data&&f>this.rowsCnt&&(f=this.rowsCnt);for(var g=e;f>g;g++){var h=d[g];h&&c.push(h.idx)}this.check(c,a)},checkAll:function(a,b){var c=this;a&&"boolean"!=typeof a||(b=a,a=null),void 0===b&&(b=!0),this._checkAll=!a&&b;var d=this.layout.find("th.col-checkbox .checkbox");a?this.forEach(function(c){var d=$.inArray(c.idx,this.selection),e=Qstore.test(c,a)&&b;return e||~d?!e&&~d?(this.selection.splice(d,1),void 0):(~d||this.selection.push(c.idx),void 0):void 0}.bind(this)):(this.selection=[],b?(d.removeClass("checked"),this.forEach(function(a){c.selection.push(a.idx)}),d.addClass("checked-all")):(this.selection=[],d.removeClass("checked-all"),d.removeClass("checked"))),this.emit("selectionChange"),this._renderChecked()},isChecked:function(a){return~$.inArray(a,this.selection)},_renderChecked:function(){var a=this,b=this.layout.find(".dtable tbody tr:not(.fake)"),c=b.length,d=0;b.each(function(){var b=$(this),c=Number(b.attr("rel"));return a._checkAll||~$.inArray(c,a.selection)?(d++,b.addClass("selected"),b.find(".col-checkbox .checkbox").addClass("checked"),void 0):(b.removeClass("selected"),b.find(".col-checkbox .checkbox").removeClass("checked"),void 0)}),this._checkAll?this.layout.find(".dtable th.col-checkbox .checkbox").removeClass("checked").addClass("checked-all"):d==c&&this.layout.find(".dtable th.col-checkbox .checkbox").addClass("checked"),this.selection.length?this.layout.addClass("has-selected"):this.layout.removeClass("has-selected")}}),a.installDefaultTemplates({checkboxHead:function(){return'<th class="col-checkbox"><div class="column-wrap"><div class="checkbox"></div></div></th>'},checkboxCell:function(a){return'<td class="col-checkbox col-first" rel="'+a.row.idx+'"><div class="checkbox" rel="'+a.row.idx+'"></div>'},checkboxFootWrap:function(a){return'<td class="col-checkbox"><div class="footer-wrap">'+a.content+"</div></td>"},checkboxFoot:function(){return""}})}(ActiveTable),!function(a){$.extend(a.prototype,{showSubrow:function(a,b,c){if(!a)return!1;var d=this.layout.find('.data-table tr[rel="'+a+'"]'),e=this.data.findOne({idx:a});if(!d.length)return!1;var f={tpl:{subrow:!0},table:this,row:e,content:b},g=$(this.templates.subrow(f));return d.addClass("has-subrow"),g.insertAfter(d),c&&g.find("td").hide().show(c),g},hideSubrow:function(a){if(!a)return this.layout.find(".has-subrow").removeClass("has-subrow"),this.layout.find(".subrow").remove(),void 0;var b=this.layout.find('.data-table tr[rel="'+a+'"]');if(b.hasClass("has-subrow")){b.removeClass("has-subrow");var c=b.next();c.hasClass("subrow")&&c.remove()}},toggleSubrow:function(a){if(a){var b=this.layout.find('.data-table tr[rel="'+a+'"]');b.hasClass("has-subrow")?this.hideSubrow(a):this.showSubrow(a)}}}),a.installDefaultTemplates({subrow:function(a){var b=a.table,c=b.visibleFields.length;b.selectable&&c++;var d=a.content;if(!d&&b.templates.master){var e=$.extend({},{tpl:{subrowContent:!0}},a);d=b.templates.master(e)}return'<tr class="subrow"><td colspan="'+c+'">'+d+"</td></tr>"}})}(ActiveTable),!function(a){function b(){this.el.on("mousedown.table",".at-checkbox",function(a){var b=$(a.currentTarget),c=b.find("input");b.hasClass("checked")?(b.removeClass("checked"),c.val("")):(b.addClass("checked"),c.val(1)),c.change()}),this.el.on("click.table",".at-dropdown-button",function(a){a.preventDefault();var b=$(a.currentTarget).closest(".at-dropdown"),c="at-dropdown-"+$.now();b.hasClass("open")||(b.addClass("open").attr("id",c),b.trigger("dropdownOpen"),setTimeout(function(){$("body").on("click."+c,function(a){var d=$(a.target);(d.hasClass(".at-dropdown-button")||d.closest(".at-dropdown-button").length||d.attr("id")!=c&&!d.closest("#"+c).length)&&($("body").off(a),b.removeClass("open"),b.trigger("dropdownClose"))})}))})}a.addListener(function(a){"attachEvents"==a&&b.call(this)})}(ActiveTable);